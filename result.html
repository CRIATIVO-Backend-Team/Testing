<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>OMR Sheet Processor - Result</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Vendor CSS -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">

  <style>
    body {
      font-family: "Nunito", sans-serif;
      background: #f8f9fa;
    }

    .card-custom {
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      background: #fff;
      margin-bottom: 1rem;
    }

    .result-img {
      width: 100%;
      border-radius: 12px;
      border: 2px dashed #dee2e6;
      height: 260px;
      object-fit: contain;
    }

    table th,
    table td {
      border: 1px solid #d6cfcf !important;
    }

    .badge-success {
      color: #2eca6a;
      background: #e0f8e9;
    }

    .badge-failed {
      color: #dc3545;
      background: #fdecea;
    }
  </style>
</head>

<body>
  <div class="container py-4">

    <h1 class="fs-4 mb-4">OMR Sheet Processed Result</h1>

    <!-- Processed Image -->
    <div class="card card-custom p-3 mb-4 text-center">
      <h6 class="text-start mb-2">Processed Sheet</h6>
      <img id="resultImg" class="result-img" src="assets/img/processed.png" alt="Processed image">
    </div>

    <!-- Exam Info -->
    <div class="card card-custom p-3 mb-4">
      <h6 class="text-dark mb-2">Exam Info</h6>
      <div class="d-flex justify-content-between">
        <div>
          <span class="fw-semibold text-muted" style="font-size: 12px;">SUC Code:</span>
          <div class="text-dark" id="sucCode">-</div>
        </div>
        <div>
          <span class="fw-semibold text-muted" style="font-size: 12px;">Exam ID:</span>
          <div class="text-dark" id="examID">-</div>
        </div>
      </div>
    </div>

    <!-- Detected Answers Table -->
    <div class="card card-custom p-4 mb-4">
      <h6 class="text-dark mb-3">Detected Answers</h6>
      <div class="table-responsive" style="height: 300px; overflow-y: auto;">
        <table class="table align-middle text-center" id="resultTable">
          <thead class="table-primary sticky-top">
            <tr>
              <th>Question</th>
              <th>Answer(s)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

  </div>

  <script>
    // Get stored API response from upload.html
    const dataStr = localStorage.getItem("omrResultData");
    if (!dataStr) {
      alert("No result data found. Please upload an OMR sheet first.");
    } else {
      const data = JSON.parse(dataStr);

      // Set exam info
      document.getElementById("sucCode").innerText = data.suc || "-";
      document.getElementById("examID").innerText = data.examID || "-";

      // Set processed image
      const imgUrl = data.image_url.startsWith("http") ? data.image_url : "https://w.aditya.ac.in/omrapi" + data.image_url;
      document.getElementById("resultImg").src = imgUrl + "?t=" + new Date().getTime();

      // Fill table
      const tbody = document.querySelector("#resultTable tbody");
      tbody.innerHTML = "";
      data.result.forEach(item => {
        const tr = document.createElement("tr");

        const qCell = document.createElement("td");
        qCell.innerText = item.question;
        tr.appendChild(qCell);

        const aCell = document.createElement("td");
        if (item.answers.length > 0) {
          aCell.innerHTML = `<span class="badge badge-success d-inline-flex align-items-center gap-1">${item.answers.join(", ")}</span>`;
        } else {
          aCell.innerHTML = `<span class="badge badge-failed d-inline-flex align-items-center gap-1">Not Answered</span>`;
        }
        tr.appendChild(aCell);

        tbody.appendChild(tr);
      });
    }
  </script>

</body>
</html>
